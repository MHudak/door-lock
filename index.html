<!DOCTYPE html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.3/jquery.mobile.min.css" />
        <style>
            
        </style>
    </head>
    <body>    
    	<div data-role="page">
    		<div data-role="header">
    			<h1>Welcome to 5535</h1>
    			</div>
    		<div data-role="content">
    			<h2>Welcome to 5535</h2>
    		</div>
   		</div><!-- page -->

   		<div data-role="page" id="enter-seed">
    		<div data-role="header">
    			<h1>Welcome to 5535</h1>
    		</div>
    		<div data-role="content">
				<h1>You're new here.</h1>
				<p>You were given a seed (fancy word for number) with your username and password.</p><h2>Enter your seed below:</h2>
    			<form id="enter-seed" action="#login" method="POST">
					<input id="user-seed" type="password" name="user-seed">
					<input type="submit" value="Go!">
				</form>
			</div>
   		</div><!-- page -->

   		<div data-role="page" id="login">
    		<div data-role="header">
    			<h1>Welcome to 5535</h1>
    		</div>
    		<div data-role="content">
    			<h1>Login</h1>
    			<form id="login" action="#lock-unlock" method="POST">
					Username: <input id="user-id" type="text" name="user-id">
					Password: <input id="user-password" type="password" name="user-password">
					<input type="submit" value="Go!">
				</form>
    		</div>
   		</div><!-- page -->
    	
   		<div data-role="page" id="success">
    		<div data-role="header">
    			<h1>Welcome to 5535</h1>
    		</div>
    		<div data-role="content">
    			<h2>success</h2>
    		</div>
   		</div><!-- page -->

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.3/jquery.mobile.min.js"></script>
		<script type="text/JavaScript">
			$( document ).ready(function() {
			    console.log( "ready!" );
			    checkCookie();
			});

			// ajax call to check seed submission
			//callback handler for form submit
			$("#enter-seed").submit(function(e)
			{
			    var postData = $(this).serializeArray();
			    var formURL = $(this).attr("action");
			    $.ajax(
			    {
			        url : formURL,
			        type: "POST",
			        data : postData,

			        // Successful seed submission, take user to login page
			        success:function(data, textStatus, jqXHR) 
			        {
			            $(":mobile-pagecontainer").pagecontainer( "change", "#login", {transition: "flip"}); 
			        },
			        error: function(jqXHR, textStatus, errorThrown) 
			        {
			            alert('failed');      
			        }
			    });
			    e.preventDefault(); //STOP default action
			    e.unbind(); //unbind. to stop multiple form submit.
			});

			//check for seed value stored on client's computer
			function checkCookie() {
				var seed=getCookie("seed");
				if (seed == "") {
					// if no seed exists, prompt user to enter their given seed value
					$(":mobile-pagecontainer").pagecontainer( "change", "#enter-seed", {transition: "flip"});
					if (seed != "" && seed != null) {
						setCookie("seed", seed, 365);
					}
				} else {
					$(":mobile-pagecontainer").pagecontainer( "change", "#login", {transition: "flip"});
				}
			}		
					
			//set seed		
			function setCookie(cname, cvalue, exdays) {
				var d = new Date();
				d.setTime(d.getTime() + (exdays*24*60*60*1000));
				var expires = "expires="+d.toUTCString();
				document.cookie = cname + "=" + cvalue + "; " + expires;
			}		

			//retrieve seed
			function getCookie(cname) {
				var name = cname + "=";
				var ca = document.cookie.split(';');
				for(var i=0; i<ca.length; i++) {
					var c = ca[i];
					while (c.charAt(0)==' ') c = c.substring(1);
					if (c.indexOf(name) != -1) return c.substring(name.length,c.length);
				}
				return "";
			}
					
			//random number generator
			var currentRandomNumberSeed = 0;
			function getRandomInt(){
				currentRandomNumberSeed = (2147483629*currentRandomNumberSeed + 2147483587)%2147483647;
				return currentRandomNumberSeed;
			}
					
			//url formatter		
			function format(value, length){
				var returnVal = new Array();
				while(length-- > 0){
					if(value > 0){
						returnVal[length] = value%10;
						value = Math.floor(value/10);
					}else{
						returnVal[length] = 0;
					}
				}
				return returnVal.join("");
			}
			
			function submit(command){
				saltedPW = calculatePassword();
				location.href = "192.168.1.20/?c=" + command + "&u=" + username + "&password=" + saltedPW;
			}

			function success(){
				var PASSWORD_LENGTH = 8;
				var seed = parseInt(getCookie("seed")) + PASSWORD_LENGTH;
				setCookie("seed", seed, 365);
				setTimeout("location.href = 'index.html';", 1000);
			}
		</script>
    </body>
</html>
